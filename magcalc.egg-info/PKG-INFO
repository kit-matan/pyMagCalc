Metadata-Version: 2.4
Name: magcalc
Version: 0.1.0
Summary: Linear Spin-Wave Theory Calculator
Author-email: Kit Matan <kmatan@example.com>
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.20.0
Requires-Dist: scipy>=1.7.0
Requires-Dist: sympy>=1.9
Requires-Dist: tqdm>=4.60.0
Requires-Dist: matplotlib>=3.4.0
Requires-Dist: pyyaml>=5.4
Requires-Dist: ase>=3.22.0
Requires-Dist: typer[all]>=0.9.0
Requires-Dist: pydantic>=2.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"

# pyMagCalc: Linear Spin-Wave Theory Calculator

[![Python 3.8+](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://www.python.org/)
[![Status](https://img.shields.io/badge/status-development-orange.svg)]()

## Introduction

`pyMagCalc` is a Python package for performing Linear Spin-Wave Theory (LSWT) calculations. It allows users to define a spin model (Hamiltonian, magnetic structure, lattice) and compute spin-wave dispersion relations and dynamic structure factors S(Q,ω).

## Key Features

*   **Diffraction Physics:** Calculates spin-wave dispersion and neutron scattering intensity (S(Q,ω)) with magnetic form factor and polarization factor corrections.
*   **Energy Minimization:** Numerically finds the classical magnetic ground state by minimizing the Hamiltonian energy, supporting both simple and complex (e.g., canted) structures.
*   **3D Visualization:** Visualizes the magnetic structure in 3D with scaled spins and correct aspect ratios.
*   **Modular Architecture:** Separation of concerns with `MagCalc` core logic, linear algebra utilities, and model definitions.
*   **Symbolic Hamiltonian:** Generates symbolic quadratic boson Hamiltonians using `SymPy` for arbitrary spin interactions.
*   **Numerical Engine:** Efficient numerical evaluation using `NumPy` and `multiprocessing` for parallel q-point calculations.
*   **Caching System:** Caches computationally expensive symbolic Hamiltonian diagonalization to disk for faster re-runs.
*   **Centralized Outputs:** Automatically saves all generated plots and data to structured directories (`examples/plots/` and `cache/data/`).
*   **Flexible Inputs:** Supports declarative YAML configurations (validated against schema) or Python-based model definitions.

## Directory Structure

*   `magcalc/`: Core Python package.
    *   `core.py`: Main `MagCalc` class and calculation logic.
    *   `generic_model.py`: `GenericSpinModel` for YAML-based model loading.
    *   `linalg.py`: Matrix operations and Bogoliubov transformation utilities.
    *   `config_loader.py`: Utilities for loading and validating configurations.
*   `scripts/`: Executable scripts for running calculations and inspecting models (e.g., `run_magcalc.py`).
*   `examples/`: Sample data and scripts for various materials.
    *   `KFe3J/`: KFe3(OH)6(SO4)2 (Jarosite) - Kagome antiferromagnet.
    *   `aCVO/`: alpha-Cu2V2O7 - Honeycomb-like antiferromagnet with Dzyaloshinskii-Moriya interactions.
    *   `plots/`: Centralized directory where all example scripts save their output plots.
*   `tests/`: Unit and integration tests ensuring package reliability.

## Dependencies

*   Python (3.8+)
*   NumPy
*   SciPy
*   SymPy
*   Matplotlib
*   tqdm
*   PyYAML
*   ASE (Atomistic Simulation Environment, used for CIF file reading)
*   pytest (for testing)

## Installation

1.  Clone the repository.
2.  Install dependencies:
    ```bash
    pip install -r requirements.txt
    ```
3.  Add the project root to your `PYTHONPATH` or run scripts from the root directory to ensure `import magcalc` works.

## Basic Usage

### Running Example Scripts

The recommended way to see `pyMagCalc` in action is to run the verified example scripts. These scripts perform energy minimization, calculate dispersion/S(Q,ω), and generate plots.

```bash
# Run the Jarosite (KFe3J) example
python examples/KFe3J/sw_KFe3J.py

# Run the CVO example
python examples/aCVO/sw_cvo.py
```

Results (plots) will be saved to `examples/plots/`.

### Scripting with Python

```python
import magcalc as mc
from magcalc.generic_model import GenericSpinModel

# 1. Initialize Calculator with a config file
calc = mc.MagCalc(config_filepath="examples/KFe3J/config.yaml")

# 2. Minimize Energy (Find Ground State)
min_res = calc.minimize_energy()
print(f"Ground State Energy: {min_res.fun} meV")

# 3. Visualize Magnetic Structure
mc.plot_magnetic_structure(
    calc.sm.atom_pos(), 
    min_res.x, 
    save_filename="structure.png"
)

# 4. Calculate Dispersion
# calc.calculate_dispersion(q_vectors) ...
```

## Spin Model Definition

Define your physics in a `config.yaml` file (recommended) or a Python module. The YAML format allows specifying:
*   **Crystal Structure**: Lattice parameters and magnetic atoms.
*   **Interactions**: Heisenberg exchange ($J$), Dzyaloshinskii-Moriya ($D$), and Single-Ion Anisotropy.
*   **Parameters**: Numerical values for symbolic constants.

See `magcalc/material_config_schema.yaml` for layout details.

## Examples

The `examples/` directory contains fully functional examples:
*   **`examples/KFe3J/`**: Extensive example for Jarosite, showcasing:
    *   Energy minimization to find the canted ground state.
    *   Declarative YAML configuration.
    *   Scripts for plotting dispersion and S(Q,ω) cuts.
*   **`examples/aCVO/`**: Alpha-Cu2V2O7 example.
    *   Comprehensive spin-wave calculations with magnetic fields.
    *   Demonstrates handling of complex magnetic structures.

## Testing

Run the test suite using `pytest` from the project root:

```bash
pytest
```
